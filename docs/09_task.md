# tasks.md｜ことばめいろ（最小デモ版まで）

目的：**「1分で遊べるデモ」**を完成させる。  
範囲：Lv1〜Lv6すべてを作り切るのではなく、まず **共通基盤＋Lv1デモ** を完成させ、次にLv2〜Lv6へ“横展開”する。

---

## 0. 成功条件（Definition of Done）

### デモ版（v0.1）で必ず満たすこと
- 起動画面 → ゲーム → クリア → 自動で次へ（または結果画面）まで通る
- 迷路テンプレから **spawn候補点の解析**ができる（near/mid/far/junction）
- 文字5つが **正しい順序判定**で進む
- ヒント ON/OFF が「おとなのせってい」で切り替わる（ゲーム中変更不可）
- 入力が PC（方向キー）とスマホ（スワイプ）で動く
- ミスしてもゲームオーバーにならず、停止＋（OFF時）点灯が動く
- localStorage に「到達Lv」「ヒント設定」が保存される

---

## 1. リポジトリ＆土台（0.5日）

- [ ] `docs/` をプロジェクト直下に作成（00〜05を保存）
- [ ] `src/` の骨組み作成（App / game / maze / input / render / data）
- [ ] 開発環境
  - [ ] Vite（推奨） or シンプルなindex.htmlで起動できる構成
  - [ ] TypeScript採用（推奨）
- [ ] `README.md` に起動手順（npm scripts）を記載

**成果物**
- プロジェクトが `npm run dev`（または同等）で起動する

---

## 2. 迷路テンプレ導入（0.5日）

- [ ] `src/game/maze/templates/` に Lv1テンプレ2つを配置
- [ ] テンプレの型（string[]）を統一
- [ ] `tools/validateTemplates`（最小）作成
  - [ ] 外周壁チェック
  - [ ] 通路存在チェック

**成果物**
- Lv1テンプレがコードから参照できる
- validateが動く（CLIでなくても関数でもOK）

---

## 3. analyzeTemplate 組み込み（0.5日）

- [ ] `src/game/maze/analyzeTemplate.ts` を配置（完成版）
- [ ] 出力 `SpawnSets` を確認できる簡易ログを作る
- [ ] 解析結果の sanity check
  - [ ] base/near/mid/far が空でない
  - [ ] 全連結（BFS unreachableなし）

**成果物**
- テンプレを渡すと分類が取れる

---

## 4. spawnPlanner（配置確定）実装（1日）

### 4.1 仕様
- Player：nearからランダム
- Ghost：junction優先（なければmid）、Player距離>=8（Lv1は不要でも可）
- Letters 5個：
  - 1文字目：near
  - 2〜4：mid
  - 5：far
- **距離制約**
  - Lv1〜2：各ステップの最短距離 <= 12
  - Lv3〜6：<= 18
- [ ] 距離制約に失敗したら再抽選（最大10回→フォールバック）

### 4.2 タスク
- [ ] `src/game/maze/spawnPlanner.ts` 作成
- [ ] BFS距離を使った `shortestPathLen(a,b)` ユーティリティ
- [ ] 重複座標防止（同じマスに2つ置かない）
- [ ] 失敗時フォールバック（除外条件緩和）

**成果物**
- 「テンプレ → 具体配置（player/letters/ghosts）」が毎回確定する

---

## 5. 入力（キー／スワイプ）統合（1日）

- [ ] `InputManager` 実装
  - [ ] 方向キーで direction/nextDirection を更新
  - [ ] スワイプ検出（距離10%・角度許容±30°）
  - [ ] タップ無効
- [ ] 簡易デバッグ表示（現在の方向をコンソールでも可）

**成果物**
- PC/スマホで移動入力が取れる

---

## 6. GameEngine 最小実装（1〜1.5日）

### 6.1 state.ts
- [ ] GameState 型
- [ ] 初期化関数（newGame(level)）

### 6.2 gameLoop.ts
- [ ] requestAnimationFrame ループ
- [ ] update(delta) / render(ctx) の分離

### 6.3 movement
- [ ] マス単位移動
- [ ] 曲がり角で nextDir 自動反映
- [ ] 壁に衝突しない（停止）

**成果物**
- 迷路内をプレイヤーが移動できる

---

## 7. レンダリング（Canvas）最小（1日）

- [ ] Canvas 1枚
- [ ] タイル描画（壁/通路）
- [ ] プレイヤー描画（丸でもOK）
- [ ] 文字アイテム描画（大きく、縁取り or 背景プレート）
- [ ] 画面下部の操作誘導（←↑→↓ アイコン）

**成果物**
- “それっぽく遊べる画面”が出る

---

## 8. 文字判定（正解／不正解）＋停止（1日）

- [ ] プレイヤーが文字マスに入ったら判定
- [ ] 正解：currentLetterIndex++ → 次の文字へ
- [ ] 不正解：freezeタイマー
  - [ ] player/ghost停止
  - [ ] ヒントOFFなら flashTimer をセット
- [ ] 5文字完了でクリア状態へ（短い演出）

**成果物**
- 5文字の順番ゲームとして成立する

---

## 9. ヒントシステム（1日）

- [ ] hintEnabled = true：上部に「つぎ → ◯」常時表示
- [ ] hintEnabled = false：不正解時だけ flashTimer で点灯
- [ ] 点灯時間は Lv帯で変える（0.5/0.3/0.2）

**成果物**
- ヒントON/OFFが体験差として明確に動く

---

## 10. ゴースト最小（Lv1用は省略可）（1日）

※ v0.1では「ランダム1体」でも良い。  
後でLvに応じて増やす。

- [ ] ghost移動（ランダム：分岐で方向選択）
- [ ] 接触判定：freeze（ゲームオーバーなし）
- [ ] 描画（色なしでOK、形だけ）

**成果物**
- パックマンらしさが出る

---

## 11. 画面遷移（Start / Settings / Game）（1日）

- [ ] StartScreen
  - [ ] タイトル＋キャッチコピー
  - [ ] 「はじめる」
  - [ ] 「おとなのせってい」（長押し3秒）
- [ ] SettingsScreen（大人用）
  - [ ] ヒント ON/OFF 切替
  - [ ] 戻る
- [ ] GameScreen
  - [ ] Canvas描画＋HUD

**成果物**
- “作品”として起動→遊ぶまでが繋がる

---

## 12. セーブ（localStorage）（0.5日）

- [ ] SaveData：`level`, `hintEnabled`
- [ ] 起動時にロード
- [ ] 設定変更時に保存
- [ ] クリア時に到達Lvを更新

**成果物**
- 次回起動しても設定が保持される

---

## 13. Lv2〜Lv6への横展開（2〜3日）

※ ここは「追加データ＋パラメータ」で済む設計にする。

- [ ] `src/game/data/levels.ts` にLv定義を追加
  - [ ] 迷路サイズ（テンプレセット）
  - [ ] 文字セット生成ルール
  - [ ] ゴースト数
  - [ ] 点灯時間
- [ ] テンプレ追加（各Lv2種類）
- [ ] 文字セット生成（まず固定でも可）
- [ ] Lv4の「カタカナ段階」実装（内部2段階）
  - [ ] 行構造
  - [ ] 複数行ミックス

**成果物**
- Lv1〜Lv6が一応通る（完成度はLv1が最優先）

---

## 14. デモ品質の仕上げ（1日）

- [ ] 文字の視認性（縁取り/背景プレート）
- [ ] スマホUIのスケーリング調整
- [ ] クリア演出を短く静かに
- [ ] 「ミス」「×」など否定表現が出ていないか確認

**成果物**
- 支援現場に持ち込める最小品質

---

## 15. 任意（後回しOK）

- [ ] 効果音/BGM
- [ ] 迷路テンプレ自動PNG化（デバッグ）
- [ ] ゴーストAIの役割分化（追跡/待ち伏せ/妨害）
- [ ] 追加アイテム（ひかり/とまれ/ならび）の拡張

---

# 推奨実装順（最短）

1) 迷路テンプレ → analyzeTemplate → spawnPlanner  
2) 入力 → 移動 → Canvas描画  
3) 文字判定 → ヒントON/OFF → クリア  
4) 画面遷移 → セーブ  
5) ゴースト最低限 → Lv展開

---

# v0.1 で最初に作るべき“たった3つ”

- spawnPlannerが動く
- 5文字の順序判定が動く
- ヒントON/OFFが動く

ここができたら、勝ち。





