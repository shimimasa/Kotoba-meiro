# ことばめいろ｜迷路仕様書（Maze Specification）

## 1. 本仕様書の目的

本書は、学習ゲーム「ことばめいろ」における  
**迷路構造・テンプレート設計・スポーン配置制約**を定義する。

迷路は本作において「難易度を上げるための仕組み」ではなく、  
**文字の順序体験を安全に運ぶための器**である。

よって、本仕様では以下を最優先とする。

- 必ず解ける
- 戻れる
- 詰まらない
- 偶然の失敗を作らない

---

## 2. 迷路設計の基本思想

### 2.1 迷路は「探索」ではなく「移動体験」

- 正解は常に存在する
- 行き止まりは“戻るため”に存在する
- プレイヤーが「判断ミスで詰む」構造を作らない

迷路は、  
**文字をたどる時間を自然に伸ばすための空間**である。

---

## 3. 迷路生成方式

### 3.1 採用方式

- **固定テンプレート制**
- ランダム生成は行わない
- 毎回変わるのは以下のみ：
  - プレイヤー開始位置
  - 文字アイテム配置
  - ゴースト配置
  - パワーアイテム配置（Lv3以降）

---

### 3.2 理由

- 難易度の安定
- デバッグ容易性
- 子どもが「地形」を覚えられる安心感
- LD配慮（予測不能性を下げる）

---

## 4. テンプレート仕様

### 4.1 サイズ

| Lv帯 | サイズ |
|---|---|
| Lv1 | 9×9 |
| Lv2 | 11×11 |
| Lv3〜Lv6 | 15×15 |

---

### 4.2 共通条件

すべてのテンプレートは以下を満たす：

- 外周はすべて壁（#）
- 通路（.）は全連結
- ループ構造を必ず含む
- 一本道が長くなりすぎない
- 分岐点が最低3箇所以上存在

---

## 5. テンプレート表現形式

- ASCII形式
- `#` = 壁
- `.` = 通路
- 1行 = 1配列要素

```txt
#########
#...#...#
#.#.#.#.#
#.......#
#########
6. 通路セルの分類
各通路セル（.）は、上下左右4方向の接続数（degree）で分類する。

種別	条件
deadEnd	degree = 1
corridor	degree = 2
junction	degree ≥ 3

7. スポーン候補点の抽出ルール
7.1 基本候補（base）
以下を満たす通路セルのみを候補とする：

degree ≥ 2

袋小路の最奥（degree = 1）は除外

7.2 弱候補の除外（詰まり防止）
以下に該当するセルは候補から除外する：

degree = 2

上下のみ or 左右のみが通路（直線廊下）

その軸方向に degree = 2 が連続3セル以上続く

いわゆる「長い廊下のど真ん中」

※ これにより、

単調な配置

追跡が過剰に強くなる地点
を避ける。

8. 仮スタートと距離計算
8.1 仮スタート
テンプレ中心に最も近い通路セルを仮スタートとする

同距離の場合、degree = 2 を優先

8.2 距離算出
仮スタートから BFS による最短距離（タイル数）を算出

すべての通路セルは到達可能であること

9. near / mid / far の定義
base候補を距離順に並べ、以下の分位で分類する：

区分	定義
near	下位 0〜33%
mid	中央 34〜66%
far	上位 67〜100%

10. 配置ルール（用途別）
10.1 プレイヤー開始位置
near から選択

ゴーストとの初期距離を確保

10.2 文字アイテム（5個）
位置	配置候補
1文字目	near
2〜4文字目	mid
5文字目	far

各文字間の最短距離は制限を設ける

Lv1〜2：最大12マス

Lv3〜6：最大18マス

10.3 ゴースト
junction または mid から配置

プレイヤー開始位置から一定距離以上

Lv1では追跡型を使用しない

10.4 パワーアイテム（Lv3以降）
junction 付近に配置

最後の文字の近くには配置しない

11. フォールバック処理
候補点が不足する場合：

長廊下除外ルールを緩和

deadEnd を含める（最終手段）

※ フォールバックが発生しても
プレイ体験が破綻しないことを優先する。

12. デバッグ・検証
全テンプレに対し以下を検証：

外周壁

全連結性

near/mid/far 分布

開発用に以下を可視化可能にする：

BFS距離

スポーン分類色分け

13. 本仕様の意図
この迷路仕様は、

迷路で迷わせない

判断で詰まらせない

失敗体験を増やさない

ためのものである。

迷路は常に
**「ことばへ進むための通路」**であり続ける。

yaml
コードをコピーする
